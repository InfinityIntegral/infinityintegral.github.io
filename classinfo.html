<!DOCTYPE html>
<html lang="en-SG">
<head>
<meta charset="UTF-8">
<title>SGEXTN Docs</title>
<style></style>
</head>
<body>
<div id="header"></div>
<div id="contents"></div>
<div id="notice"></div>
<div id="footer"></div>
<script> (async () => {

// written by ChatGPT
// std::string getTextFile(const std::string& path)
async function getTextFile(path) {
    try {
        const res = await fetch(path);
        if (!res.ok) return 'failed to load resources';
        return await res.text();
    } catch {
        return 'failed to load resources';
    }
}

// the functions below are translated from C++ to JS by ChatGPT
function formatDescription(s) {
    let output = "&#x9;";
    for (let i = 0; i < s.length; i++) {
        output += (s[i] !== '$') ? s[i] : "<br>&#x9;";
    }
    return output;
}

function toLowerCase(s) {
    let output = "";
    for (let i = 0; i < s.length; i++) {
        let c = s[i];
        if (c >= 'a' && c <= 'z' || c >= '0' && c <= '9') output += c;
        else if (c >= 'A' && c <= 'Z') output += c.toLowerCase();
    }
    return output;
}

function compareObj(a, b) {
    let extract = str => {
        let res = "", started = false;
        for (let i = 0; i < str.length; i++) {
            let c = str[i];
            if (c === '_' || c.match(/[a-zA-Z0-9]/)) {
                if (started) res += c;
            } else if (c === '$') started = true;
            else break;
        }
        return {res, started};
    };
    let {res: sa, started: saStarted} = extract(a);
    let {res: sb, started: sbStarted} = extract(b);
    if (!saStarted) return a < b;
    return sa < sb;
}

function splitObj(a) {
    let o1 = "", o2 = "", o3 = "";
    let started = 0;
    for (let i = 0; i < a.length; i++) {
        let c = a[i];
        if (c === '_' || c.match(/[a-zA-Z0-9]/)) {
            if (started === 0) o1 += c;
            else if (started === 1) o2 += c;
            else o3 += c;
        } else if (c === '$') started = 1;
        else {
            if (started === 0) o1 += c;
            else if (started === 1) { o3 += c; started = 2; }
            else o3 += c;
        }
    }
    return [o1, o2, o3];
}

function toHtmlTag(s) {
    let output = "#";
    let x = false;
    for (let i = 0; i < s.length; i++) {
        let c = s[i];
        if (c >= 'a' && c <= 'z' || c >= '0' && c <= '9') { output += c; x = false; }
        else if (c >= 'A' && c <= 'Z') { output += c.toLowerCase(); x = false; }
        else { if (!x) { output += '-'; x = true; } }
    }
    return output;
}

function addObjList(map, s) {
    for (let [key, val] of map) {
        let [s1, s2, s3] = splitObj(key);
        s.value += `<p class="label">&#x9;${s1}<a class="link" href="${toHtmlTag(key)}">${s2}</a>${s3}</p>\n`;
    }
}

function addObjFull(map, s) {
    for (let [key, val] of map) {
        let [s1, s2, s3] = splitObj(key);
        s.value += `<h2 class="halftitle" id="${toHtmlTag(key).substr(1)}">&#x9;${s1}<a class="link" href="${toHtmlTag(key)}">${s2}</a>${s3}</h2>\n`;
        s.value += `<p class="label">${formatDescription(val)}<br>&nbsp;</p>\n`;
    }
}

function genClassInfo(input) {
    let className = "", classDescription = "", include = "", parentClass = "";
    let childrenClasses = [];
    let enumName = "", enumDescription = "";
    let enumFlags = new Map(), memberProperties = new Map(), memberFunctions = new Map();
    let staticProperties = new Map(), staticFunctions = new Map();
    let memberReimplemented = new Map(), staticReimplemented = new Map();
    let laterDescription = "", detailedDescription = new Map();

    let lines = input.split('\n');
    for (let idx = 0; idx < lines.length; idx++) {
        let s = lines[idx];
        if (!s) continue;
        if (s[0] !== '#') return "invalid syntax: " + s;
        let spaceIdx = s.indexOf(' ');
        if(spaceIdx == -1) spaceIdx = s.length;
        let type = s.substring(1, spaceIdx);
        let value = s.substring(spaceIdx + 1);

        if (type === "c") { className = value; classDescription = lines[++idx]; }
        else if (type === "ic") include = value;
        else if (type === "if") parentClass = value;
        else if (type === "it") childrenClasses.push(value);
        else if (type === "e") { enumName = value; enumDescription = lines[++idx]; }
        else if (type === "ef") enumFlags.set(value, lines[++idx]);
        else if (type === "p") memberProperties.set(value, lines[++idx]);
        else if (type === "f") memberFunctions.set(value, lines[++idx]);
        else if (type === "sp") staticProperties.set(value, lines[++idx]);
        else if (type === "sf") staticFunctions.set(value, lines[++idx]);
        else if (type === "r") memberReimplemented.set(value, lines[++idx]);
        else if (type === "sr") staticReimplemented.set(value, lines[++idx]);
        else if (type === "d") laterDescription = value;
        else if (type === "dt") detailedDescription.set(value, lines[++idx]);
        else return "invalid type: " + type + " " + s;
    }

    let output = {value: ""};
    output.value += `<h1 class="title">${className}</h1>\n`;
    output.value += `<p class="label">${formatDescription(classDescription)}</p>\n`;
    output.value += `<p class="label">&nbsp;<br>&#x9;header: #include" ${include}"</p>\n`;
    output.value += parentClass ? 
        `<p class="label">&#x9;inherits: <a class="link" href="./classinfo.html?classname=${toLowerCase(parentClass)}">${parentClass}</a></p>\n` :
        `<p class="label">&#x9;inherits: none</p>\n`;

    if (childrenClasses.length > 0) {
        output.value += `<p class="label">&#x9;inherited by:</p>\n`;
        for (let child of childrenClasses)
            output.value += `<p class="label">&#x9;&#x9;<a class="link" href="./classinfo.html?classname=${toLowerCase(child)}">${child}</a></p>\n`;
    }

    output.value += `<p class="label">&#x9;<a class="link" href="#moreinfo">More information...</a></p>`;
    output.value += `<p class="label">&nbsp;</p>`;

    if (enumName) {
        output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n`;
        output.value += `<h2 class="halftitle">Attached Enum</h2>\n`;
        output.value += `<p class="label">&#x9;enum <a class="link" href="#enum${toLowerCase(enumName)}">${enumName}</a></p>\n`;
        for (let [k] of enumFlags) output.value += `<p class="label">&#x9;&#x9;<a class="link" href="#flag${toLowerCase(k)}">${k}</a></p>\n`;
        output.value += `<p class="label">&#x9;</p>`;
    }

    if (memberProperties.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Instance Properties</h2>\n`; addObjList(memberProperties, output); output.value += "<p class=\"label\">&nbsp;</p>"; }
    if (memberFunctions.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Instance Methods</h2>\n`; addObjList(memberFunctions, output); output.value += "<p class=\"label\">&nbsp;</p>"; }
    if (memberReimplemented.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Reimplemented Instance Methods</h2>\n`; addObjList(memberReimplemented, output); output.value += "<p class=\"label\">&nbsp;</p>"; }
    if (staticProperties.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Static Properties</h2>\n`; addObjList(staticProperties, output); output.value += "<p class=\"label\">&nbsp;</p>"; }
    if (staticFunctions.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Static Methods</h2>\n`; addObjList(staticFunctions, output); output.value += "<p class=\"label\">&nbsp;</p>"; }
    if (staticReimplemented.size > 0) { output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Reimplemented Static Methods</h2>\n`; addObjList(staticReimplemented, output); output.value += "<p class=\"label\">&nbsp;</p>"; }

    output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n`;
    output.value += `<h2 class="halftitle" id="moreinfo">Detailed Description</h2>\n`;
    output.value += `<p class="label">${formatDescription(laterDescription)}</p>\n`;

    for (let [k, v] of detailedDescription) {
        output.value += `<h2 class="halftitle">${k}</h2>\n`;
        output.value += `<p class="label">${formatDescription(v)}</p>\n`;
    }

    output.value += "<p class=\"label\">&nbsp;</p>";
    output.value += `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n`;

    if (enumName) {
        output.value += `<h2 class="halftitle" id="enum${toLowerCase(enumName)}"><a class="link" href="#enum${toLowerCase(enumName)}">${enumName}</a></h2>\n`;
        output.value += `<p class="label">${formatDescription(enumDescription)}<br>&nbsp;</p>\n`;
        for (let [k, v] of enumFlags) {
            output.value += `<h2 class="halftitle" id="flag${toLowerCase(k)}">${enumName} <a class="link" href="#flag${toLowerCase(k)}">${k}</a></h2>\n`;
            output.value += `<p class="label">${formatDescription(v)}<br>&nbsp;</p>\n`;
        }
    }

    addObjFull(memberProperties, output);
    addObjFull(memberFunctions, output);
    addObjFull(memberReimplemented, output);
    addObjFull(staticProperties, output);
    addObjFull(staticFunctions, output);
    addObjFull(staticReimplemented, output);

    return output.value;
}


document.querySelector("style").outerHTML = await getTextFile("style.html");
document.querySelector("#header").outerHTML = await getTextFile("header.html");
document.querySelector("#notice").outerHTML = await getTextFile("classinfo/classinfo.html");
document.querySelector("#footer").outerHTML = await getTextFile("footer.html");

const params = new URLSearchParams(window.location.search);
const s = params.get("classname");
document.querySelector("#contents").outerHTML = genClassInfo(await getTextFile("docs/" + s + ".html"));

})(); </script>
</body>
</html>

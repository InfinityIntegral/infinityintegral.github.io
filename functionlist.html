<!DOCTYPE html>
<html lang="en-SG">
<head>
<meta charset="UTF-8">
<title>SGEXTN Docs</title>
<style></style>
</head>
<body>
<div id="header"></div>
<div id="contents"></div>
<div id="notice"></div>
<div id="footer"></div>
<script> (async () => {

// written by ChatGPT
// std::string getTextFile(const std::string& path)
async function getTextFile(path) {
    try {
        const res = await fetch(path);
        if (!res.ok) return 'failed to load resources';
        return await res.text();
    } catch {
        return 'failed to load resources';
    }
}

// the functions below are translated from C++ to JS by ChatGPT
class ClassInfo {
    constructor() {
        this.className = "";
        this.parentName = "";
        this.enumName = "";
        this.enumFlags = [];
        this.memberProperties = [];
        this.memberFunctions = [];
        this.staticProperties = [];
        this.staticFunctions = [];
        this.memberReimplemented = [];
        this.staticReimplemented = [];
    }
}

function toLowerCase(s) {
    let output = "";
    for (let i = 0; i < s.length; i++) {
        const c = s[i];
        if (c >= 'a' && c <= 'z') output += c;
        else if (c >= 'A' && c <= 'Z') output += c.toLowerCase();
        else if (c >= '0' && c <= '9') output += c;
    }
    return output;
}

function splitObj(a) {
    let o1 = "", o2 = "", o3 = "";
    let started = 0;
    for (let i = 0; i < a.length; i++) {
        const c = a[i];
        if (c === '_' || (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z') || (c >= '0' && c <= '9')) {
            if (started === 0) o1 += c;
            else if (started === 1) o2 += c;
            else o3 += c;
        } else if (c === '$') {
            started = 1;
        } else {
            if (started === 0) o1 += c;
            else if (started === 1) { o3 += c; started = 2; }
            else o3 += c;
        }
    }
    return [o1, o2, o3];
}

function toHtmlTag(s) {
    let output = "#";
    let x = false;
    for (let i = 0; i < s.length; i++) {
        const c = s[i];
        if (c >= 'a' && c <= 'z' || c >= '0' && c <= '9') {
            output += c;
            x = false;
        } else if (c >= 'A' && c <= 'Z') {
            output += c.toLowerCase();
            x = false;
        } else {
            if (!x) { output += '-'; x = true; }
        }
    }
    return output;
}

function addObjList(x, s, cn) {
    for (let i = 0; i < x.length; i++) {
        const [s1, s2, s3] = splitObj(x[i]);
        s += "<p class=\"label\">&#x9;";
        s += s1;
        s += `<a class="link" href="./classinfo.html?classname=${toLowerCase(cn)}${toHtmlTag(x[i])}">${cn}::${s2}</a>`;
        s += s3;
        s += "</p>\n";
    }
    return s;
}

async function genClassInfo(input) {
    const output = new ClassInfo();
    const lines = input.split("\n");
    for (let i = 0; i < lines.length; i++) {
        let s = lines[i].trim();
        if (!s) continue;
        if (s[0] !== "#") continue; // skip invalid lines

        let type = "";
        let value = "";
        for (let j = 1; j < s.length; j++) {
            if (s[j] === " ") {
                value = s.slice(j + 1);
                break;
            }
            type += s[j];
        }

        switch (type) {
            case "c":
                output.className = value;
                document.title = value + " list";
                i++; // skip next line
                break;
            case "e":
                output.enumName = value;
                i++; // skip next line
                break;
            case "ef":
                output.enumFlags.push(value);
                i++; // skip next line
                break;
            case "p":
                output.memberProperties.push(value);
                i++; // skip next line
                break;
            case "f":
                output.memberFunctions.push(value);
                i++; // skip next line
                break;
            case "sp":
                output.staticProperties.push(value);
                i++; // skip next line
                break;
            case "sf":
                output.staticFunctions.push(value);
                i++; // skip next line
                break;
            case "r":
                output.memberReimplemented.push(value);
                i++; // skip next line
                break;
            case "sr":
                output.staticReimplemented.push(value);
                i++; // skip next line
                break;
            case "if":
                output.parentName = value;
                break;
            case "dt":
                i++; // skip next line
                break;
        }
    }
    return output;
}

async function getClassInfoList(input) {
    const reversedList = [];
    let currentClass = input;
    while (currentClass) {  // stops if currentClass is "", null, or undefined
        const content = await getTextFile(`docs/${currentClass}.html`);
        const nextClass = await genClassInfo(content);
        reversedList.push(nextClass);
        currentClass = nextClass.parentName || "";  // fallback to "" if undefined
    }
    return reversedList.reverse();
}

async function genFunctionList(input) {
    const data = await getClassInfoList(input);
    let enumHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Attached Enum</h2>\n`;
    let pHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Instance Properties</h2>\n`;
    let fHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Instance Methods</h2>\n`;
    let rHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Reimplemented Instance Methods</h2>\n`;
    let spHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Static Properties</h2>\n`;
    let sfHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Static Methods</h2>\n`;
    let srHTML = `<div style="width: 100%; height: 0.25em; background-color: var(--c4);"></div>\n<h2 class="halftitle">Reimplemented Static Methods</h2>\n`;

    let enumUsed = false, pUsed = false, fUsed = false, rUsed = false, spUsed = false, sfUsed = false, srUsed = false;

    for (const currentClass of data) {
        if (currentClass.enumName) {
            enumUsed = true;
            enumHTML += `<p class="label">&#x9;enum <a class="link" href="./classinfo.html?classname=${toLowerCase(currentClass.className)}#enum${toLowerCase(currentClass.enumName)}">${currentClass.className}::${currentClass.enumName}</a></p>\n`;
            for (const flag of currentClass.enumFlags) {
                enumHTML += `<p class="label">&#x9;&#x9;<a class="link" href="./classinfo.html?classname=${toLowerCase(currentClass.className)}#flag${toLowerCase(flag)}">${currentClass.className}::${flag}</a></p>\n`;
            }
        }
        if (currentClass.memberProperties.length > 0) { pUsed = true; pHTML = addObjList(currentClass.memberProperties, pHTML, currentClass.className); }
        if (currentClass.memberFunctions.length > 0) { fUsed = true; fHTML = addObjList(currentClass.memberFunctions, fHTML, currentClass.className); }
        if (currentClass.memberReimplemented.length > 0) { rUsed = true; rHTML = addObjList(currentClass.memberReimplemented, rHTML, currentClass.className); }
        if (currentClass.staticProperties.length > 0) { spUsed = true; spHTML = addObjList(currentClass.staticProperties, spHTML, currentClass.className); }
        if (currentClass.staticFunctions.length > 0) { sfUsed = true; sfHTML = addObjList(currentClass.staticFunctions, sfHTML, currentClass.className); }
        if (currentClass.staticReimplemented.length > 0) { srUsed = true; srHTML = addObjList(currentClass.staticReimplemented, srHTML, currentClass.className); }
    }

    let output = `<h1 class="title">${data[data.length-1].className}</h1>\n`;
    output += `<p class="label">&#x9;This page contains a list of all properties and methods found in ${data[data.length-1].className}, including inherited ones. By clicking the link on each property or method, you can access its documentation page.</p>\n`;
    output += `<p class="label">&nbsp;</p>`;
    if (enumUsed) output += enumHTML + `<p class="label">&nbsp;</p>`;
    if (pUsed) output += pHTML + `<p class="label">&nbsp;</p>`;
    if (fUsed) output += fHTML + `<p class="label">&nbsp;</p>`;
    if (rUsed) output += rHTML + `<p class="label">&nbsp;</p>`;
    if (spUsed) output += spHTML + `<p class="label">&nbsp;</p>`;
    if (sfUsed) output += sfHTML + `<p class="label">&nbsp;</p>`;
    if (srUsed) output += srHTML + `<p class="label">&nbsp;</p>`;
    return output;
}


document.querySelector("style").outerHTML = await getTextFile("style.html");
document.querySelector("#header").outerHTML = await getTextFile("header.html");
document.querySelector("#notice").outerHTML = await getTextFile("classinfo/classinfo.html");
document.querySelector("#footer").outerHTML = await getTextFile("footer.html");

const params = new URLSearchParams(window.location.search);
const s = params.get("classname");
document.querySelector("#contents").outerHTML = await genFunctionList(s);

const fragment = window.location.hash;
if (fragment) {
    const el = document.querySelector(fragment);
    if (el) el.scrollIntoView();
}

})(); </script>
</body>
</html>
